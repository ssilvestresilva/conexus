DROP TABLE IF EXISTS curso_aluno;
DROP TABLE IF EXISTS curso;
DROP TABLE IF EXISTS resultado;
DROP TABLE IF EXISTS resultado_produto;
DROP TABLE IF EXISTS resultado_compras;
DROP TABLE IF EXISTS produtos_compra;
DROP TABLE IF EXISTS compras_usuario;
DROP TABLE IF EXISTS compras;
DROP TABLE IF EXISTS aluno;
DROP TABLE IF EXISTS cartoes_usuario;
DROP TABLE IF EXISTS enderecos_usuario;
DROP TABLE IF EXISTS usuario;
DROP TABLE IF EXISTS produto;

CREATE TABLE IF NOT EXISTS curso (
	id SERIAL PRIMARY KEY,
	descricao VARCHAR(100) NOT NULL,
	segmento VARCHAR(50) NOT NULL,
	periodo VARCHAR(50) NOT NULL,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS aluno (
	id SERIAL PRIMARY KEY,
	nome VARCHAR(100) NOT NULL,
	cpf SMALLINT NOT NULL,
	dta_nascimento DATE NOT NULL,
	endereco TEXT NOT NULL,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS resultado (
	id SERIAL PRIMARY KEY,
	id_aluno INTEGER NOT NULL,
	curso VARCHAR(75) NOT NULL,
	instituicao VARCHAR(75) NOT NULL,
	periodo VARCHAR(10) NOT NULL,
	resultado DECIMAL NOT NULL DEFAULT 0.0,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	CONSTRAINT fk_aluno FOREIGN KEY (id_aluno)
		REFERENCES aluno (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS curso_aluno (
	id_curso INTEGER NOT NULL,
	id_aluno INTEGER NOT NULL,
	CONSTRAINT fk_curso FOREIGN KEY (id_curso)
		REFERENCES curso (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION,
	CONSTRAINT fk_aluno FOREIGN KEY (id_aluno)
		REFERENCES aluno (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS usuario (
	id SERIAL PRIMARY KEY,
	nome VARCHAR(100) NOT NULL,
	cpf VARCHAR(75) NOT NULL,
	email VARCHAR(75) NOT NULL,
	senha VARCHAR(75) NOT NULL,
	perfil VARCHAR(75) NOT NULL,
	telefone_contato VARCHAR(75) NULL,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS produto (
	id serial NOT NULL,
	cod_produto int4 NOT NULL,
	descricao varchar(100) NOT NULL,
	vlr_distribuidor NUMERIC(5,2) NULL DEFAULT 0,
	vlr_admin NUMERIC(5,2) NULL DEFAULT 0,
	quantidade int4 NOT NULL,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	dta_atualizacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	ativo bool NOT NULL DEFAULT false,
	CONSTRAINT produto_cod_produto UNIQUE (cod_produto),
	CONSTRAINT produto_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS resultado_produto (
	id SERIAL PRIMARY KEY,
	id_produto INTEGER NOT NULL,
	resultado DECIMAL NOT NULL DEFAULT 0.0,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	last_data_base date NOT NULL,
	CONSTRAINT fk_produto FOREIGN KEY (id_produto)
		REFERENCES produto (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS compras (
	id SERIAL PRIMARY KEY,
	cod_compra INTEGER NOT NULL,
	vlr_compra NUMERIC(5,2) NULL DEFAULT 0,
	quantidade INTEGER NOT NULL,
	dta_pedido TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	forma_pagamento varchar(100) NOT NULL,
	dta_pagamento TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	status_pagamento varchar(100) NOT NULL,
	dta_envio TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	status_envio varchar(100) NOT NULL
);

CREATE TABLE IF NOT EXISTS compras_usuario (
	id_compra INTEGER NOT NULL,
	id_usuario INTEGER NOT NULL,
	CONSTRAINT fk_compras FOREIGN KEY (id_compra)
		REFERENCES compras (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION,
	CONSTRAINT fk_usuario FOREIGN KEY (id_usuario)
		REFERENCES usuario (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS enderecos_usuario (
	id_usuario INTEGER NOT NULL,
	cidade VARCHAR(75) NULL,
	cep VARCHAR(75) NULL,
	rua VARCHAR(75) NULL,
	numero int4 NULL,
	favorito bool NULL DEFAULT false,
	CONSTRAINT fk_usuario FOREIGN KEY (id_usuario)
		REFERENCES usuario (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS cartoes_usuario (
	id_usuario INTEGER NOT NULL,
	nome_cartao VARCHAR(75) NULL,
	numero_cartao int4 NULL,
	favorito bool NULL DEFAULT false,
	CONSTRAINT fk_usuario FOREIGN KEY (id_usuario)
		REFERENCES usuario (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS produtos_compra (
	id_compra INTEGER NOT NULL,
	id_produto INTEGER NOT NULL,
	CONSTRAINT fk_compras FOREIGN KEY (id_compra)
		REFERENCES compras (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION,
	CONSTRAINT fk_produto FOREIGN KEY (id_produto)
		REFERENCES produto (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS resultado_compras (
	id SERIAL PRIMARY KEY,
	id_compra INTEGER NOT NULL,
	resultado DECIMAL NOT NULL DEFAULT 0.0,
	dta_criacao TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
	last_data_base date NOT NULL,
	CONSTRAINT fk_compras FOREIGN KEY (id_compra)
		REFERENCES compras (id) MATCH SIMPLE
		ON UPDATE NO ACTION
		ON DELETE NO ACTION
);